<!--
	This section is from Chirpy's sidebar.html:
	https://github.com/cotes2020/jekyll-theme-chirpy/blob/master/_includes/sidebar.html
-->

<!-- The Side Bar -->

<div id="sidebar" class="d-flex flex-column align-items-end">
	<div class="profile-wrapper">
		<a href="{{ '/' | relative_url }}" id="avatar" class="rounded-circle">
			{% if site.avatar != empty and site.avatar %}
				{% capture avatar_url %}
						{% if site.avatar contains '://' %}
							{{ site.avatar }}
						{% elsif site.img_cdn != empty and site.img_cdn %}
							{{ site.avatar | prepend: site.img_cdn }}
						{% else %}
							{{ site.avatar | relative_url }}
						{% endif %}
					{% endcapture %}
				<img src="{{ avatar_url | strip }}" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
			{% endif %}
		</a>

		<div class="site-title">
			<a href="{{ '/' | relative_url }}">{{ site.title }}</a>
		</div>
		<div class="site-subtitle fst-italic">{{ site.tagline }}</div>
	</div>
	<!-- .profile-wrapper -->

	<ul class="nav flex-column flex-grow-1 w-100 ps-0">
		<!-- home -->
		<li class="nav-item{% if page.layout == 'home' %}{{ " active" }}{% endif %}">
			<a href="{{ '/' | relative_url }}" class="nav-link">
				<i class="fa-fw fas fa-home"></i>
				<span>{{ site.data.locales[include.lang].tabs.home | upcase }}</span>
			</a>
		</li>
		<!-- the real tabs -->
		{% for tab in site.tabs %}
			<li class="nav-item{% if tab.url == page.url %}{{ " active" }}{% endif %}">
				<a href="{{ tab.url | relative_url }}" class="nav-link">
					<i class="fa-fw {{ tab.icon }}"></i>
					{% capture tab_name %}{{ tab.url | split: '/' }}{% endcapture %}

					<span>{{ site.data.locales[include.lang].tabs.[tab_name] | default: tab.title | upcase }}</span>
				</a>
			</li>
			<!-- .nav-item -->
		{% endfor %}
	</ul>
	<!-- ul.nav.flex-column -->

	<div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
		{% unless site.theme_mode %}
			<button class="mode-toggle btn" aria-label="Switch Mode">
				<i class="fas fa-adjust"></i>
			</button>

			{% if site.data.contact.size > 0 %}
				<span class="icon-border"></span>
			{% endif %}
		{% endunless %}

		{% for entry in site.data.contact %}
			{% case entry.type %}
				{% when 'github', 'twitter' %}
					{%- capture url -%}
						https://{{ entry.type }}.com/{{ site[entry.type].username }}
					{%- endcapture -%}
				{% when 'email' %}
					{% assign email = site.social.email | split: '@' %}
					{%- capture url -%}
						javascript:location.href = 'mailto:' + ['{{ email[0] }}','{{ email[1] }}'].join('@')
					{%- endcapture -%}
				{% when 'rss' %}
					{% assign url = '/feed.xml' | relative_url %}
				{% else %}
					{% assign url = entry.url %}
			{% endcase %}

			{% if url %}
				<a
					href="{{ url }}"
					aria-label="{{ entry.type }}"
					{% assign link_types = '' %}

					{% unless entry.noblank %}
						target="_blank"
						{% assign link_types = 'noopener noreferrer' %}
					{% endunless %}

					{% if entry.type == 'mastodon' %}
						{% assign link_types = link_types | append: ' me' | strip %}
					{% endif %}

					{% unless link_types == empty %}
						rel="{{ link_types }}"
					{% endunless %}
				>
					<i class="{{ entry.icon }}"></i>
				</a>
			{% endif %}
		{% endfor %}
	</div>
	<!-- .sidebar-bottom -->
</div>
<!-- #sidebar -->

<!--
	Custom whattf.how code
-->
<script>
	// Available avatars
	const avatarImgFolder = "/assets/img";
	const orangeAvatarPath = `${avatarImgFolder}/logo-orange.png`;
	const orangeBorderColor = "#FF8827";
	const purpleAvatarPath = `${avatarImgFolder}/logo-purple.png`;
	const purpleBorderColor = "#33006F";
	const goldAvatarPath = `${avatarImgFolder}/logo-gold.png`;
	const goldBorderColor = "#917b4c";

	// Bind to the mode switcher button and toggle the avatar image
	const modeSwitcher = document.getElementsByClassName("mode-toggle")[0];
	const lightThemeAvatarPath = goldAvatarPath;
	const lightThemeBorderColor = goldBorderColor;
	const darkThemeAvatarPath = purpleAvatarPath;
	const darkThemeBorderColor = purpleBorderColor;

	// Chirpy will add `data-mode="light"` to the html element if in light
	//   theme and will not have the attribute at all if in dark theme
	var isCurrentlyLightTheme =
		document.documentElement.hasAttribute("data-mode");

	// Helper methods
	const getAvatarElement = () => {
		return document.querySelector("#avatar");
	};
	const getAvatarImage = () => {
		return document.querySelector("#avatar img");
	};
	const makeSetThemeFunc = (imageSrc, borderColor, isLightTheme) => {
		const avatar = getAvatarElement();
		const avatarImage = getAvatarImage();

		return () => {
			avatar.style.setProperty(
				"--avatar-border-color",
				borderColor
			);
			avatarImage.src = imageSrc;
			isCurrentlyLightTheme = isLightTheme;
		};
	};
	const setDarkTheme = makeSetThemeFunc(
		darkThemeAvatarPath,
		darkThemeBorderColor,
		false
	);
	const setLightTheme = makeSetThemeFunc(
		lightThemeAvatarPath,
		lightThemeBorderColor,
		true
	);

	// Make sure that the avatar gets set to the current theme's avatar
	// This is needed because the _config.yml defaults the avatar to the dark
	//   theme avatar, but the user could already be in the light theme
	if (isCurrentlyLightTheme) {
		setLightTheme();
	} else {
		setDarkTheme();
	}

	// Bind to the mode switcher to update the avatar
	modeSwitcher.addEventListener("click", function() {
		if (isCurrentlyLightTheme) {
			setDarkTheme();
		} else {
			setLightTheme();
		}
	});
</script>
